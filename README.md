# Маркетплейс

## Описание

Проект представляет собой маркетплейс, построенный на основе микросервисной архитектуры с использованием **gRPC** для внутреннего взаимодействия. Для внешних клиентов интегрирован **API Gateway**, а **Nginx** используется как обратный прокси-сервер, маршрутизируя запросы и перенаправляя трафик между микросервисами.

Данные пользователей хранятся в **PostgreSQL**, где для каждого сервиса выделена своя база данных. Для повышения эффективности и ускорения доступа к данным используется **Redis** в микросервисе управления проектами. Безопасность взаимодействий с системой реализована через использование JWT-токенов.

В проекте поддерживается **Observability**. С каждого микросервиса собираются метрики с помощью **Prometheus**. Для сбора логов реализован **Kafka** producer, который асинхронно отправляет данные в **Promtail**, откуда логи далее отправляются **Loki**. Трэйсы обрабатываются через **OpenTelemetry**, и попадают в **Tempo**. Для визуализации, мониторинга и анализа данных используется **Grafana**, которая объединяет трейсы, метрики и логи.

## Структура проекта

1. **Auth**  
   Микросервис, отвечающий за регистрацию, вход и авторизацию пользователей. Для защиты данных и безопасного доступа используются JWT-токены. Взаимодействие между сервисами реализовано через gRPC.

2. **User**  
   Микросервис, предназначенный для управления профилем пользователя, включая обновление данных.

3. **Product**  
   Микросервис для управления продуктами.

4. **Order**  
   Микросервис, предназначенный для обработки заказов, управления состоянием и историей заказов.

5. **Payment**  
   Микросервис, который отвечает за обработку платежей и взаимодействие с платежными системами.

## Технологии

- **Go** — основной язык программирования для разработки микросервисов и их логики.
- **gRPC** — используется для внутреннего взаимодействия между микросервисами.
- **API Gateway** — обрабатывает внешние запросы и маршрутизирует их на соответствующие микросервисы.
- **JWT-токены** — для безопасной аутентификации и авторизации пользователей.
- **Nginx** — выполняет роль обратного прокси-сервера, обеспечивая маршрутизацию запросов.
- **Docker** — используется для контейнеризации микросервисов и разработки пользовательских приложений.
- **PostgreSQL** — основная база данных для хранения информации о пользователях, продуктах и платежах.
- **Redis** — применяется для кэширования данных в микросервисах, что позволяет значительно ускорить операции.
- **Grafana** — используется для мониторинга состояния сервисов и анализа производительности.
- **Prometheus** — система для сбора и хранения метрик с микросервисов.
- **Kafka** — используется для сбора и отправки логов в систему наблюдения.
- **Promtail** — промежуточный сервис для получения логов и их отправки в Loki.
- **Loki** — система для хранения и структурирования логов, интегрированная с Grafana.
- **Tempo** — используется для сбора и анализа спанов и распределенных трасс.


## Отказоустойчивость

В проекте реализованы ключевые паттерны для обеспечения надежности и отказоустойчивости:

**Graceful Shutdown**

Все микросервисы поддерживают корректное завершение работы, что позволяет завершать активные запросы перед остановкой, корректно закрывать соединения с базами данных и внешними сервисами, а также освобождать ресурсы.

**Circuit Breaker**

Реализован паттерн "Circuit Breaker" для защиты от повторяющихся сбоев и управления ошибками во взаимодействиях между микросервисами.

**Retry**

Реализован паттерн "Retry" для попыток отправки сообщений в AuthService, также для создания соединения с базой Postgres.

**Timeout**

Реализован паттерн "Timeout" для всех клиентских grpc запросов, также используется в некоторых методах сервисов.

# Методы API

Документация по методам API доступна в папке docs. Для визуализации документации рекомендуется использовать https://editor.swagger.io/

## Установка

### Требования

1. Docker
2. Go 1.24.1+

### Сборка 

```docker-compose up --build```

## Итог 

Lead - [@RidusM](https://t.me/RidusM)

Engineer - [@ursulgwopp](https://t.me/ursulgwopp)

Engineer - maxime